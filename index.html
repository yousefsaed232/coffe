<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="utf-8" />
    <title>Ø®Ø±ÙŠØ·Ø© Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø¨Ù† â€” ØªÙØ§Ø¹Ù„ÙŠ ÙˆÙØ®Ù…</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --brown-900: #4e342e;
        --brown-700: #6f4e37;
        --beige: #fff7f0;
        --accent: #c48b5b;
        --light-brown: #a1887f;
      }
      html,
      body,
      #map {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: "Cairo", sans-serif;
        direction: rtl;
      }
      body {
        background: linear-gradient(135deg, #f7ede2 0%, #efe1cc 100%);
        color: var(--brown-900);
      }
      #sidebar {
        position: absolute;
        left: 12px;
        top: 12px;
        width: 320px;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 12px;
        padding: 16px;
        z-index: 1100;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(4px);
        transition: transform 0.3s ease;
      }
      #sidebar.collapsed {
        transform: translateX(-300px);
      }
      #sidebar h1 {
        margin: 0 0 8px 0;
        font-size: 20px;
        color: var(--brown-900);
        display: flex;
        align-items: center;
        gap: 8px;
      }
      #sidebar p {
        margin: 8px 0 14px 0;
        font-size: 14px;
        color: #5b4035;
        line-height: 1.5;
      }
      .group {
        margin-bottom: 14px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding-bottom: 14px;
      }
      .group:last-child {
        border-bottom: none;
      }
      .btn {
        display: block;
        width: 100%;
        border: none;
        background: var(--brown-700);
        color: #fff;
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        margin-bottom: 8px;
        transition: transform 0.15s ease, background 0.15s ease,
          box-shadow 0.15s ease;
        font-family: "Cairo", sans-serif;
      }
      .btn:hover {
        transform: translateY(-3px);
        background: var(--accent);
        box-shadow: 0 4px 12px rgba(196, 139, 91, 0.3);
      }
      .btn.active {
        background: var(--accent);
        box-shadow: 0 0 0 2px rgba(196, 139, 91, 0.3);
      }
      .small-btn {
        background: #fff;
        color: var(--brown-900);
        border: 1px solid #eee;
        padding: 8px 12px;
        font-size: 13px;
        display: inline-block;
        width: auto;
        margin-right: 8px;
        margin-bottom: 8px;
      }
      .label {
        font-weight: 600;
        margin-bottom: 8px;
        color: #4b322b;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      #descBox {
        margin-top: 10px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.95),
          rgba(255, 250, 245, 0.95)
        );
        border-radius: 8px;
        padding: 12px;
        font-size: 14px;
        color: #5a3f35;
        min-height: 60px;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
        line-height: 1.6;
      }
      #map {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
      }
      .popup-card {
        width: 320px;
        text-align: right;
        direction: rtl;
        font-family: "Cairo", sans-serif;
      }
      .popup-card img {
        width: 100%;
        height: 160px;
        object-fit: cover;
        border-radius: 8px;
        display: block;
        margin-bottom: 10px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.18);
        transform-origin: center;
        animation: popIn 0.25s ease;
      }
      .popup-title {
        font-weight: 700;
        font-size: 18px;
        color: var(--brown-900);
        margin-bottom: 8px;
      }
      .popup-sub {
        color: #795548;
        font-size: 14px;
        margin-bottom: 10px;
        line-height: 1.5;
      }
      .progress-wrap {
        background: #efebe9;
        border-radius: 8px;
        padding: 8px;
        margin-bottom: 10px;
      }
      .progress-label {
        font-size: 13px;
        color: #5b4035;
        margin-bottom: 8px;
      }
      .progress-bar {
        width: 100%;
        height: 12px;
        background: #fff;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.05);
      }
      .progress-fill {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #c48b5b, #6f4e37);
        transition: width 1100ms cubic-bezier(0.2, 0.9, 0.2, 1);
      }
      .bouncy {
        animation: bounceIn 0.6s cubic-bezier(0.2, 0.9, 0.2, 1);
      }
      @keyframes bounceIn {
        0% {
          transform: translateY(-20px) scale(0.9);
          opacity: 0;
        }
        60% {
          transform: translateY(6px) scale(1.04);
          opacity: 1;
        }
        100% {
          transform: translateY(0) scale(1);
        }
      }
      @keyframes popIn {
        from {
          transform: scale(0.98) translateY(6px);
          opacity: 0;
        }
        to {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
      }
      #searchBox {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 12px;
        font-family: "Cairo", sans-serif;
        direction: rtl;
        box-sizing: border-box;
      }
      #statsPanel {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        padding: 12px;
        margin-top: 10px;
        display: none;
      }
      .stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 6px;
        font-size: 13px;
      }
      .comparison-panel {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        padding: 16px;
        width: 300px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        display: none;
      }
      .comparison-header {
        font-weight: 700;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .close-btn {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: var(--brown-700);
      }
      .comparison-item {
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }
      .buy-btn {
        display: block;
        width: 100%;
        background: var(--accent);
        color: white;
        border: none;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        font-family: "Cairo", sans-serif;
        font-weight: 600;
        margin-top: 10px;
        transition: background 0.2s;
      }
      .buy-btn:hover {
        background: var(--brown-700);
      }
      .loader {
        display: none;
        text-align: center;
        padding: 10px;
        color: var(--brown-700);
      }
      .loader-spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid var(--accent);
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
        margin: 0 auto 8px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .toggle-sidebar {
        position: absolute;
        right: -40px;
        top: 16px;
        background: var(--brown-700);
        color: white;
        border: none;
        border-radius: 0 8px 8px 0;
        width: 40px;
        height: 40px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      }
      @media (max-width: 780px) {
        #sidebar {
          left: 8px;
          top: 8px;
          width: 280px;
          padding: 12px;
        }
        .popup-card {
          width: 280px;
        }
        .comparison-panel {
          width: 90%;
          right: 5%;
          bottom: 10px;
        }
        .toggle-sidebar {
          right: -35px;
          width: 35px;
          height: 35px;
        }
      }
      @media (max-width: 480px) {
        #sidebar {
          width: 90vw;
          left: 5vw;
        }
        .toggle-sidebar {
          right: -30px;
          width: 30px;
          height: 30px;
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div id="sidebar" aria-label="Sidebar">
      <button class="toggle-sidebar" id="toggleSidebar">â˜°</button>
      <h1>â˜• Ø®Ø±ÙŠØ·Ø© Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø¨Ù†</h1>
      <p>Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù‚Ø§Ø±Ø§Øª/Ø§Ù„Ù‚ÙØ·Ø¹ ÙˆØ£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø®Ø±Ø§Ø¦Ø· â€” Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù‚Ø§Ø±Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</p>

      <div class="group">
        <div class="label">ğŸ” Ø§Ù„Ø¨Ø­Ø«</div>
        <input
          type="text"
          id="searchBox"
          placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø²Ø±Ø¹Ø© Ø£Ùˆ Ù…Ù†Ø·Ù‚Ø©..."
        />
      </div>
      <div class="group">
        <div class="label">ğŸŒ Ø§Ù„Ù‚Ø§Ø±Ø§Øª</div>
        <div id="continentButtons"></div>
      </div>
      <div class="group">
        <div class="label">ğŸ—ºï¸ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø®Ø±Ø§Ø¦Ø·</div>
        <div id="basemapButtons"></div>
      </div>
      <div class="group">
        <div class="label">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</div>
        <div id="statsPanel">
          <div class="stat-item">
            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹:</span>
            <span id="totalFarms">0</span>
          </div>
          <div class="stat-item">
            <span>Ø£Ø¹Ù„Ù‰ Ø¥Ù†ØªØ§Ø¬:</span>
            <span id="topProducer">-</span>
          </div>
          <div class="stat-item">
            <span>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†ØªØ§Ø¬:</span>
            <span id="avgProduction">0%</span>
          </div>
        </div>
      </div>
      <div class="group">
        <div class="label">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>
        <div id="descBox">Ø§Ø®ØªØ± Ù‚Ø§Ø±Ø© Ø£Ùˆ Ù†Ù‚Ø·Ø© Ù„Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØµÙ„Ø©.</div>
      </div>
      <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
      </div>
      <div class="group">
        <button id="resetBtn" class="small-btn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶</button>
        <button id="compareBtn" class="small-btn">âš–ï¸ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</button>
        <button id="statsBtn" class="small-btn">ğŸ“ˆ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
      </div>
    </div>
    <div id="map"></div>
    <div class="comparison-panel" id="comparisonPanel">
      <div class="comparison-header">
        <span>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</span>
        <button class="close-btn" id="closeComparison">âœ•</button>
      </div>
      <div id="comparisonContent"></div>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      const coffeeLocations = [
        {
          id: "sa_fayfa",
          country: "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©",
          region: "Ø¬Ø§Ø²Ø§Ù† â€” ÙÙŠÙØ§Ø¡",
          lat: 17.2473,
          lon: 43.1069,
          continent: "Ø¢Ø³ÙŠØ§",
          image:
            "https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=7a6d6b9fd0a9d7b4f7c7d35e2f5a2e5a",
          production_pct: 0.1,
          phone: "phone:00966",
          description:
            "Ù‚Ù‡ÙˆØ© ÙÙŠÙØ§Ø¡ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ØªØ´ØªÙ‡Ø± Ø¨Ù†ÙƒÙ‡ØªÙ‡Ø§ Ø§Ù„Ù…Ù…ÙŠØ²Ø© ÙˆØ²Ø±Ø§Ø¹ØªÙ‡Ø§ ÙÙŠ Ø§Ù„Ù…Ø±ØªÙØ¹Ø§Øª Ø§Ù„Ø¬Ø¨Ù„ÙŠØ© Ø¨Ù…Ù†Ø·Ù‚Ø© Ø¬Ø§Ø²Ø§Ù†.",
          buy_link: "https://example.com/coffee/saudi-fayfa",
          video_link: "https://www.youtube.com/embed/mNAVcYSm-1U",
        },
        {
          id: "ye_haraz",
          country: "Ø§Ù„ÙŠÙ…Ù†",
          region: "Ø¬Ø¨Ù„ Ø­Ø±Ø§Ø²",
          lat: 15.39,
          lon: 43.62,
          continent: "Ø¢Ø³ÙŠØ§",
          image:
            "https://images.unsplash.com/photo-1517685352821-92cf88aee5a5?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=2e6f7f6c9b1c1a5f7c2b1a6a3e2f3b4a",
          production_pct: 0.7,
          phone: "phone:00967",
          description:
            "Ù‚Ù‡ÙˆØ© ÙŠÙ…Ù†ÙŠØ© Ø£ØµÙŠÙ„Ø© Ù…Ù† Ø¬Ø¨Ù„ Ø­Ø±Ø§Ø²ØŒ ØªØªÙ…ÙŠØ² Ø¨Ù†ÙƒÙ‡Ø© Ù‚ÙˆÙŠØ© ÙˆØªØ§Ø±ÙŠØ® Ø¹Ø±ÙŠÙ‚ ÙÙŠ Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø¨Ù†.",
          buy_link: "https://example.com/coffee/yemen-haraz",
          video_link: "https://www.youtube.com/embed/I77xlRQxwcE",
        },
        {
          id: "et_yirg",
          country: "Ø¥Ø«ÙŠÙˆØ¨ÙŠØ§",
          region: "ÙŠØ±Ù‚Ø§ØªØ´ÙŠÙ (Yirgacheffe)",
          lat: 5.8,
          lon: 38.25,
          continent: "Ø£ÙØ±ÙŠÙ‚ÙŠØ§",
          image:
            "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=8f9c3d9d3f5f6b2b6c7d8e9f0a1b2c3d",
          production_pct: 10,
          phone: "phone:00251",
          description:
            "Ù‚Ù‡ÙˆØ© ÙŠØ±Ù‚Ø§ØªØ´ÙŠÙ Ø§Ù„Ø¥Ø«ÙŠÙˆØ¨ÙŠØ© ØªØ´ØªÙ‡Ø± Ø¨Ù†ÙƒÙ‡Ø§ØªÙ‡Ø§ Ø§Ù„Ø²Ù‡Ø±ÙŠØ© ÙˆØ§Ù„ÙÙˆØ§ÙƒÙ‡ÙŠØ© ÙˆØ§Ù„Ø­Ù…ÙˆØ¶Ø© Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†Ø©.",
          buy_link: "https://example.com/coffee/ethiopia-yirgacheffe",
          video_link: "https://www.youtube.com/embed/_GnANWORnWk",
        },
        {
          id: "et_harar",
          country: "Ø¥Ø«ÙŠÙˆØ¨ÙŠØ§",
          region: "Ù‡Ø±Ø± (Harrar)",
          lat: 9.3,
          lon: 42.1,
          continent: "Ø£ÙØ±ÙŠÙ‚ÙŠØ§",
          image:
            "https://images.unsplash.com/photo-1447078806655-40579c2520d6?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=769cfa7a1b3d9d6b9d7f8c6a5b4e3a2f",
          production_pct: 6,
          phone: "phone:00251",
          description:
            "Ù‚Ù‡ÙˆØ© Ù‡Ø±Ø± Ø§Ù„Ø¥Ø«ÙŠÙˆØ¨ÙŠØ© Ø°Ø§Øª Ø§Ù„Ù†ÙƒÙ‡Ø© Ø§Ù„ØºÙ†ÙŠØ© ÙˆØ§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªÙŠØ© Ù…Ø¹ Ù„Ù…Ø³Ø§Øª Ù…Ù† Ø§Ù„ØªÙˆØª.",
          buy_link: "https://example.com/coffee/ethiopia-harrar",
          video_link: "https://www.youtube.com/embed/_GnANWORnWk",
        },
        {
          id: "br_minas",
          country: "Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„",
          region: "Ù…ÙŠÙ†Ø§Ø³ Ø¬ÙŠØ±Ø§ÙŠØ³",
          lat: -21.5,
          lon: -45.3,
          continent: "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©",
          image:
            "https://upload.wikimedia.org/wikipedia/commons/c/c5/Roasted_coffee_beans.jpg",
          production_pct: 35,
          phone: "phone:0055",
          description:
            "Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ Ø£ÙƒØ¨Ø± Ù…Ù†ØªØ¬ Ù„Ù„Ù‚Ù‡ÙˆØ© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŒ ÙˆÙ‚Ù‡ÙˆØ© Ù…ÙŠÙ†Ø§Ø³ Ø¬ÙŠØ±Ø§ÙŠØ³ Ù…Ø¹Ø±ÙˆÙØ© Ø¨Ù†ÙƒÙ‡ØªÙ‡Ø§ Ø§Ù„Ø¬ÙˆØ²ÙŠØ© Ø§Ù„Ù…Ø¹ØªØ¯Ù„Ø©.",
          buy_link: "https://example.com/coffee/brazil-minas",
          video_link: "https://www.youtube.com/embed/aDbzF6pj0X4",
        },
        {
          id: "co_antioquia",
          country: "ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠØ§",
          region: "Ø£Ù†ØªÙŠÙˆÙƒÙŠØ§ (Ù…ÙŠØ¯ÙŠÙ„ÙŠÙ†)",
          lat: 6.2442,
          lon: -75.5812,
          continent: "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©",
          image:
            "https://upload.wikimedia.org/wikipedia/commons/2/2b/Coffee_Farm_near_Ibiraci_town.jpg",
          production_pct: 15,
          phone: "phone:0057",
          description:
            "Ù‚Ù‡ÙˆØ© ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠØ§ Ù…Ù† Ù…Ù†Ø·Ù‚Ø© Ø£Ù†ØªÙŠÙˆÙƒÙŠØ§ ØªØªÙ…ÙŠØ² Ø¨Ø­Ù…ÙˆØ¶Ø© Ù„Ø·ÙŠÙØ© ÙˆÙ†ÙƒÙ‡Ø© Ù…ØªÙˆØ§Ø²Ù†Ø©.",
          buy_link: "https://example.com/coffee/colombia-antioquia",
          video_link: "https://www.youtube.com/embed/CCOMM84jhZg",
        },
        {
          id: "vn_buon",
          country: "ÙÙŠØªÙ†Ø§Ù…",
          region: "Ø¨ÙˆÙˆÙ† Ù…Ø§ ØªÙˆØª",
          lat: 12.7957,
          lon: 108.0521,
          continent: "Ø¢Ø³ÙŠØ§",
          image:
            "https://upload.wikimedia.org/wikipedia/commons/2/2b/Coffee_Farm_near_Ibiraci_town.jpg",
          production_pct: 9,
          phone: "phone:0084",
          description:
            "ÙÙŠØªÙ†Ø§Ù… Ø«Ø§Ù†ÙŠ Ø£ÙƒØ¨Ø± Ù…Ù†ØªØ¬ Ù„Ù„Ù‚Ù‡ÙˆØ© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŒ ØªÙ†ØªØ¬ principalmente Ù‚Ù‡ÙˆØ© Ø±ÙˆØ¨ÙˆØ³ØªØ§.",
          buy_link: "https://example.com/coffee/vietnam-buon",
          video_link: "https://www.youtube.com/embed/LH6adMz0y6M",
        },
        {
          id: "id_takengon",
          country: "Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ§",
          region: "Takengon - Gayo",
          lat: 4.6175,
          lon: 96.7971,
          continent: "Ø¢Ø³ÙŠØ§",
          image:
            "https://images.unsplash.com/photo-1470337458703-46ad1756a187?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=a5f6b7c8d9e0f1a2b3c4d5e6f7081928",
          production_pct: 8,
          phone: "phone:0062",
          description:
            "Ù‚Ù‡ÙˆØ© Ø³ÙˆÙ…Ø·Ø±Ø© Ø§Ù„Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ© Ù…Ù† Ù…Ù†Ø·Ù‚Ø© ØºØ§ÙŠÙˆ Ù…Ø¹Ø±ÙˆÙØ© Ø¨Ù†ÙƒÙ‡ØªÙ‡Ø§ Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ© ÙˆØ§Ù„ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ø¬Ø³Ù….",
          buy_link: "https://example.com/coffee/indonesia-gayo",
          video_link: "https://www.youtube.com/embed/shorts/0cTmoTwXwnQ",
        },
        {
          id: "gt_antigua",
          country: "ØºÙˆØ§ØªÙŠÙ…Ø§Ù„Ø§",
          region: "Ø£Ù†ØªÙŠØºÙˆØ§",
          lat: 14.5586,
          lon: -90.7346,
          continent: "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„ÙˆØ³Ø·Ù‰",
          image:
            "https://upload.wikimedia.org/wikipedia/commons/f/f6/Coffee_Plantation.jpg",
          production_pct: 3,
          phone: "phone:00502",
          description:
            "Ù‚Ù‡ÙˆØ© Ø£Ù†ØªÙŠØºÙˆØ§ Ø§Ù„ØºÙˆØ§ØªÙŠÙ…Ø§Ù„ÙŠØ© ØªØ´ØªÙ‡Ø± Ø¨Ù†ÙƒÙ‡ØªÙ‡Ø§ Ø§Ù„ØºÙ†ÙŠØ© Ø¨Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© ÙˆØ§Ù„ÙƒØ§Ø±Ø§Ù…ÙŠÙ„.",
          buy_link: "https://example.com/coffee/guatemala-antigua",
          video_link: "https://www.youtube.com/embed/UKA1-sUPtvI",
        },
        {
          id: "cr_tarrazu",
          country: "ÙƒÙˆØ³ØªØ§Ø±ÙŠÙƒØ§",
          region: "ØªØ§Ø±Ø§Ø²Ùˆ",
          lat: 9.6208,
          lon: -84.1639,
          continent: "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„ÙˆØ³Ø·Ù‰",
          image:
            "https://upload.wikimedia.org/wikipedia/commons/2/20/Fazenda_Da_Lagoa.jpg",
          production_pct: 2,
          phone: "phone:00506",
          description:
            "Ù‚Ù‡ÙˆØ© ØªØ§Ø±Ø§Ø²Ùˆ Ø§Ù„ÙƒÙˆØ³ØªØ§Ø±ÙŠÙƒÙŠØ© Ù…Ø¹Ø±ÙˆÙØ© Ø¨Ø­Ù…ÙˆØ¶ØªÙ‡Ø§ Ø§Ù„Ø¨Ø±Ø§Ù‚Ø© ÙˆÙ†ÙƒÙ‡Ø§ØªÙ‡Ø§ Ø§Ù„ÙÙˆØ§ÙƒÙ‡ÙŠØ©.",
          buy_link: "https://example.com/coffee/costa-rica-tarrazu",
          video_link: "https://www.youtube.com/embed/D2L4uwSoDi8",
        },
      ];
      const MAPBOX_TOKEN =
        "pk.eyJ1IjoieW91c2Vmc2FlZCIsImEiOiJjbWdqd3pmYjkwbDg1MmpzZ2Z6ajNuOTBuIn0.7udOUcyBq8MmvCZBrFO8dw";

      if (!MAPBOX_TOKEN || MAPBOX_TOKEN.includes("XXXXXXXX")) {
        console.warn(
          "Ø¶Ø¹ Mapbox Access Token ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± MAPBOX_TOKEN Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù Ù‚Ø¨Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„."
        );
      }
      const map = L.map("map", {
        center: [8, 10],
        zoom: 2,
        worldCopyJump: true,
      });
      const baseLayers = {
        "ÙˆØ§Ù‚Ø¹ÙŠØ© (Satellite)": L.tileLayer(
          `https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token=${MAPBOX_TOKEN}`,
          { tileSize: 512, zoomOffset: -1, attribution: "Tiles Â© Mapbox" }
        ),
        "Ø´ÙˆØ§Ø±Ø¹ (Streets)": L.tileLayer(
          `https://api.mapbox.com/styles/v1/mapbox/streets-v12/tiles/{z}/{x}/{y}?access_token=${MAPBOX_TOKEN}`,
          { tileSize: 512, zoomOffset: -1, attribution: "Tiles Â© Mapbox" }
        ),
        "ØªØ¶Ø§Ø±ÙŠØ³ (Outdoors)": L.tileLayer(
          `https://api.mapbox.com/styles/v1/mapbox/outdoors-v12/tiles/{z}/{x}/{y}?access_token=${MAPBOX_TOKEN}`,
          { tileSize: 512, zoomOffset: -1, attribution: "Tiles Â© Mapbox" }
        ),
        "Ø¯Ø§ÙƒÙ†Ø© (Dark)": L.tileLayer(
          `https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/{z}/{x}/{y}?access_token=${MAPBOX_TOKEN}`,
          { tileSize: 512, zoomOffset: -1, attribution: "Tiles Â© Mapbox" }
        ),
      };
      baseLayers["Ø´ÙˆØ§Ø±Ø¹ (Streets)"].addTo(map);
      const continents = {
        Ø¢Ø³ÙŠØ§: "ÙÙŠ Ø¢Ø³ÙŠØ§ ØªÙØ²Ø±Ø¹ Ø§Ù„Ù‚Ù‡ÙˆØ© Ø®Ø§ØµØ© ÙÙŠ Ø§Ù„ÙŠÙ…Ù†ØŒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (Ø¬Ø§Ø²Ø§Ù†)ØŒ ÙÙŠØªÙ†Ø§Ù… ÙˆØ¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ§ â€” Ø£Ù†Ù…Ø§Ø· Ù…ØªØ¹Ø¯Ø¯Ø© Ø¨ÙŠÙ† Ø£Ø±Ø§Ø¨ÙŠÙƒØ§ ÙˆØ±ÙˆØ¨ÙˆØ³ØªØ§.",
        Ø£ÙØ±ÙŠÙ‚ÙŠØ§:
          "Ø¥Ø«ÙŠÙˆØ¨ÙŠØ§ Ù…Ù‡Ø¯ Ø§Ù„Ù‚Ù‡ÙˆØ© ÙˆØªÙ†ØªØ¬ Ø£Ù†ÙˆØ§Ø¹Ù‹Ø§ Ù…Ø¹Ù‚Ø¯Ø© ÙˆÙ†ÙƒÙ‡Ø© ÙØ§ÙƒÙ‡ÙŠØ©/Ø²Ù‡ÙˆØ±ÙŠØ© Ù…ØªÙ…ÙŠØ²Ø©. Ø¯ÙˆÙ„ Ø£Ø®Ø±Ù‰: ÙƒÙŠÙ†ÙŠØ§ØŒ Ø±ÙˆØ§Ù†Ø¯Ø§.",
        "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©":
          "Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ ÙˆÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠØ§ Ù‡Ù…Ø§ Ù‚Ù…Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ â€” ÙƒÙ…ÙŠØ§Øª Ø¶Ø®Ù…Ø© ÙˆÙ…ØªÙ†ÙˆØ¹Ø© ÙÙŠ Ø§Ù„Ù†ÙƒÙ‡Ø©.",
        "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„ÙˆØ³Ø·Ù‰":
          "ØºÙˆØ§ØªÙŠÙ…Ø§Ù„Ø§ ÙˆÙƒÙˆØ³ØªØ§Ø±ÙŠÙƒØ§ ÙˆÙ‡Ù†Ø¯ÙˆØ±Ø§Ø³ ØªÙ†ØªØ¬ Ø£Ø¬ÙˆØ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø±Ø§Ø¨ÙŠÙƒØ§ ÙÙŠ Ù…Ù†Ø§Ø·Ù‚ Ø¬Ø¨Ù„ÙŠØ©.",
      };
      const continentButtons = document.getElementById("continentButtons");
      const basemapButtons = document.getElementById("basemapButtons");
      const descBox = document.getElementById("descBox");
      const resetBtn = document.getElementById("resetBtn");
      const searchBox = document.getElementById("searchBox");
      const statsPanel = document.getElementById("statsPanel");
      const statsBtn = document.getElementById("statsBtn");
      const compareBtn = document.getElementById("compareBtn");
      const comparisonPanel = document.getElementById("comparisonPanel");
      const closeComparison = document.getElementById("closeComparison");
      const comparisonContent = document.getElementById("comparisonContent");
      const loader = document.getElementById("loader");
      const toggleSidebar = document.getElementById("toggleSidebar");
      let markersLayer = L.layerGroup().addTo(map);
      let selectedFarms = [];
      let currentBaseLayer = "Ø´ÙˆØ§Ø±Ø¹ (Streets)";
      Object.keys(continents).forEach((name) => {
        const b = document.createElement("button");
        b.className = "btn";
        b.textContent = name;
        b.onclick = () => showContinent(name);
        continentButtons.appendChild(b);
      });
      Object.keys(baseLayers).forEach((name) => {
        const b = document.createElement("button");
        b.className = "btn";
        if (name === currentBaseLayer) b.classList.add("active");
        b.textContent = name;
        b.onclick = () => switchBaseLayer(name);
        basemapButtons.appendChild(b);
      });
      const coffeeIcon = L.divIcon({
        className: "coffee-marker",
        html: `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="11" fill="#6f4e37"/>
          <path d="M8 12c0-2.2 1.8-4 4-4v8c-2.2 0-4-1.8-4-4z" fill="#fff" opacity="0.12"/>
        </svg>`,
        iconSize: [34, 34],
        iconAnchor: [17, 34],
        popupAnchor: [0, -34],
      });
      function showContinent(continentName) {
        showLoader();
        descBox.innerHTML = `<strong>${continentName}</strong><br/>${continents[continentName]}`;
        markersLayer.clearLayers();
        selectedFarms = [];
        const points = coffeeLocations.filter(
          (p) => p.continent === continentName
        );
        points.forEach((p, idx) => {
          setTimeout(() => {
            const marker = L.marker([p.lat, p.lon], { icon: coffeeIcon });
            marker.addTo(markersLayer);
            const popupHtml = `
              <div class="popup-card">
                <img src="${p.image}" alt="Ù…Ø²Ø±Ø¹Ø© Ù‚Ù‡ÙˆØ© ÙÙŠ ${p.region}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE2MCIgdmlld0JveD0iMCAwIDMyMCAxNjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjMyMCIgaGVpZ2h0PSIxNjAiIGZpbGw9IiNGRjdGMkYiLz48dGV4dCB4PSIxNjAiIHk9IjgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOEY2RjRGIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiPuaWh+Wtl+WbvuW9kuaAp+i+heWvvOWFizwvdGV4dD48L3N2Zz4='">
                <div class="popup-title">${p.country} â€” ${p.region}</div>
                <div class="popup-sub">${p.description}</div>
                <div class="popup-sub">${p.phone}</div>
                <div class="popup-sub">Ù…Ø³Ø§Ù‡Ù…Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ§Ø¬: ${p.production_pct}%</div>
                <div class="progress-wrap">
                  <div class="progress-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ (ØªÙ‚Ø¯ÙŠØ±ÙŠ)</div>
                  <div class="progress-bar"><div class="progress-fill" data-p="${p.production_pct}"></div></div>
                </div>
                <button class="buy-btn" onclick="window.open('${p.buy_link}', '_blank')">ğŸ›’ Ø´Ø±Ø§Ø¡ Ù‚Ù‡ÙˆØ© ${p.region}</button>
                <button class="video-btn" onclick="window.open('${p.video_link}', '_blank')" style="width: 100%; margin-top: 8px; background-color:#d9534f; color:white;">ğŸ¥ Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</button>
                <button class="small-btn" onclick="addToComparison('${p.id}')" style="width: 100%; margin-top: 8px;">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</button>
              </div>
            `;
            marker.bindPopup(popupHtml, {
              maxWidth: 340,
              className: "fancy-popup",
            });
            const el = marker.getElement();
            if (el) el.classList.add("bouncy");
            if (idx === 0) {
              marker.openPopup();
            }
            marker.on("popupopen", (e) => {
              setTimeout(() => {
                const fill = e.popup
                  .getElement()
                  .querySelector(".progress-fill");
                if (fill) {
                  let pct = parseFloat(fill.getAttribute("data-p")) || 0;
                  if (pct > 100) pct = 100;
                  fill.style.width = Math.min(pct, 100) + "%";
                }
              }, 80);
            });
          }, idx * 420);
        });
        if (points.length) {
          const bounds = L.latLngBounds(points.map((p) => [p.lat, p.lon]));
          map.flyToBounds(bounds.pad(0.6), { duration: 1.6 });
        }
        updateStats();
        hideLoader();
      }
      function switchBaseLayer(name) {
        Object.values(baseLayers).forEach((layer) => {
          if (map.hasLayer(layer)) map.removeLayer(layer);
        });
        baseLayers[name].addTo(map);
        currentBaseLayer = name;
        document.querySelectorAll("#basemapButtons .btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");
        if (!map.hasLayer(markersLayer)) markersLayer.addTo(map);
      }
      resetBtn.onclick = () => {
        map.setView([8, 10], 2);
        markersLayer.clearLayers();
        descBox.innerHTML = "Ø§Ø®ØªØ± Ù‚Ø§Ø±Ø© Ø£Ùˆ Ù†Ù‚Ø·Ø© Ù„Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØµÙ„Ø©.";
        selectedFarms = [];
        updateStats();
      };
      searchBox.addEventListener("input", function () {
        const searchTerm = this.value.toLowerCase();
        if (searchTerm.length < 2) return;
        const results = coffeeLocations.filter(
          (location) =>
            location.country.toLowerCase().includes(searchTerm) ||
            location.region.toLowerCase().includes(searchTerm) ||
            location.continent.toLowerCase().includes(searchTerm)
        );
        if (results.length > 0) {
          markersLayer.clearLayers();
          results.forEach((location) => {
            const marker = L.marker([location.lat, location.lon], {
              icon: coffeeIcon,
            });
            marker.addTo(markersLayer);
            const popupHtml = `
              <div class="popup-card">
                <img src="${location.image}" alt="Ù…Ø²Ø±Ø¹Ø© Ù‚Ù‡ÙˆØ© ÙÙŠ ${location.region}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE2MCIgdmlld0JveD0iMCAwIDMyMCAxNjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjMyMCIgaGVpZ2h0PSIxNjAiIGZpbGw9IiNGRjdGMkYiLz48dGV4dCB4PSIxNjAiIHk9IjgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOEY2RjRGIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiPuaWh+Wtl+WbvuW9kuaAp+i+heWvvOWFizwvdGV4dD48L3N2Zz4='">
                <div class="popup-title">${location.country} â€” ${location.region}</div>
                <div class="popup-sub">${location.description}</div>
                <div class="popup-sub">${location.phone}</div>
                <div class="popup-sub">Ù…Ø³Ø§Ù‡Ù…Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ§Ø¬: ${location.production_pct}%</div>
                <div class="progress-wrap">
                  <div class="progress-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ (ØªÙ‚Ø¯ÙŠØ±ÙŠ)</div>
                  <div class="progress-bar"><div class="progress-fill" data-p="${location.production_pct}"></div></div>
                </div>
                <button class="buy-btn" onclick="window.open('${location.buy_link}', '_blank')">ğŸ›’ Ø´Ø±Ø§Ø¡ Ù‚Ù‡ÙˆØ© ${location.region}</button>
                <button class="video-btn" onclick="playVideo('${location.video_link}')" style="width: 100%; margin-top: 8px; background-color:#d9534f; color:white;">ğŸ¥ Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</button>
                <button class="small-btn" onclick="addToComparison('${location.id}')" style="width: 100%; margin-top: 8px;">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</button>
              </div>
            `;
            marker.bindPopup(popupHtml, {
              maxWidth: 340,
              className: "fancy-popup",
            });
            marker.on("popupopen", (e) => {
              setTimeout(() => {
                const fill = e.popup
                  .getElement()
                  .querySelector(".progress-fill");
                if (fill) {
                  let pct = parseFloat(fill.getAttribute("data-p")) || 0;
                  if (pct > 100) pct = 100;
                  fill.style.width = Math.min(pct, 100) + "%";
                }
              }, 80);
            });
          });
          const bounds = L.latLngBounds(
            results.map((location) => [location.lat, location.lon])
          );
          map.flyToBounds(bounds.pad(0.6), { duration: 1.6 });
        }
      });
      function updateStats() {
        const visibleFarms = markersLayer.getLayers().length;
        document.getElementById("totalFarms").textContent = visibleFarms;
        if (visibleFarms > 0) {
          const farmsData = coffeeLocations.filter((location) =>
            markersLayer
              .getLayers()
              .some(
                (marker) =>
                  marker.getLatLng().lat === location.lat &&
                  marker.getLatLng().lng === location.lon
              )
          );
          if (farmsData.length > 0) {
            const topProducer = farmsData.reduce((prev, current) =>
              prev.production_pct > current.production_pct ? prev : current
            );
            document.getElementById(
              "topProducer"
            ).textContent = `${topProducer.region} (${topProducer.production_pct}%)`;

            const avgProduction =
              farmsData.reduce((sum, farm) => sum + farm.production_pct, 0) /
              farmsData.length;
            document.getElementById(
              "avgProduction"
            ).textContent = `${avgProduction.toFixed(1)}%`;
          }
        } else {
          document.getElementById("topProducer").textContent = "-";
          document.getElementById("avgProduction").textContent = "0%";
        }
      }
      statsBtn.onclick = () => {
        if (statsPanel.style.display === "block") {
          statsPanel.style.display = "none";
          statsBtn.textContent = "ğŸ“ˆ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª";
        } else {
          statsPanel.style.display = "block";
          statsBtn.textContent = "ğŸ“Š Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª";
          updateStats();
        }
      };
      function addToComparison(farmId) {
        const farm = coffeeLocations.find((f) => f.id === farmId);
        if (farm && !selectedFarms.some((f) => f.id === farmId)) {
          selectedFarms.push(farm);
          updateComparisonPanel();
        }
      }
      function toggleVideo(id, videoLink) {
        const container = document.getElementById(`video-${id}`);
        const iframe = container.querySelector("iframe");
        if (container.style.display === "none") {
          let embedLink = videoLink;
          if (videoLink.includes("youtu.be")) {
            const videoId = videoLink.split("youtu.be/")[1].split("?")[0];
            embedLink = `https://www.youtube.com/embed/${videoId}`;
          } else if (videoLink.includes("watch?v=")) {
            const videoId = videoLink.split("v=")[1].split("&")[0];
            embedLink = `https://www.youtube.com/embed/${videoId}`;
          }
          iframe.src = embedLink;
          container.style.display = "block";
        } else {
          iframe.src = "";
          container.style.display = "none";
        }
      }
      function updateComparisonPanel() {
        if (selectedFarms.length === 0) {
          comparisonContent.innerHTML =
            "<p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ø²Ø§Ø±Ø¹ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø¹Ø¯.</p>";
          return;
        }
        let html = "";
        selectedFarms.forEach((farm) => {
          html += `
            <div class="comparison-item">
              <div><strong>${farm.country} - ${farm.region}</strong></div>
              <div>Ø§Ù„Ø¥Ù†ØªØ§Ø¬: ${farm.production_pct}%</div>
              <button class="small-btn" onclick="removeFromComparison('${farm.id}')">Ø¥Ø²Ø§Ù„Ø©</button>
            </div>
          `;
        });
        comparisonContent.innerHTML = html;
        if (selectedFarms.length > 0) {
          comparisonPanel.style.display = "block";
        }
      }
      function removeFromComparison(farmId) {
        selectedFarms = selectedFarms.filter((f) => f.id !== farmId);
        updateComparisonPanel();
      }
      compareBtn.onclick = () => {
        if (comparisonPanel.style.display === "block") {
          comparisonPanel.style.display = "none";
        } else {
          comparisonPanel.style.display = "block";
          updateComparisonPanel();
        }
      };
      closeComparison.onclick = () => {
        comparisonPanel.style.display = "none";
      };
      function showLoader() {
        loader.style.display = "block";
      }
      function hideLoader() {
        loader.style.display = "none";
      }
      toggleSidebar.onclick = () => {
        document.getElementById("sidebar").classList.toggle("collapsed");
      };
      map.on("click", () => {
        map.closePopup();
      });
      updateStats();
    </script>
  </body>
</html>
